\section{Evaluation}\label{sec:evaluation}

\subsection{Experimental Setup}

We implement SwitchBox on a Hardkernel Odroid XU3 ARM big.LITTLE system with
Samsung Exynos 5422 A15/A7 heterogeneous multi-processing quad core CPUs at
maximum clock speed, 2 gigabyte LPDDR3 RAM at 933 MHz, and an eMMC5.0 HS400
backing store running Ubuntu Trusty 14.04.6 LTS, kernel version 3.10.106.

We evaluate SwitchBox using a RAM disk. The maximum theoretical memory bandwidth
for this Odroid model is 14.9GB/s\@. Our observed maximum memory bandwidth is
4.5GB/s.

We evaluate SwitchBox on four workloads: sequential I/O, random I/O, sequential
``write once ready many'' (WORM), and random WORM.

In this section we answer the following questions:
\begin{enumerate}
 \item Can SwitchBox reach security/energy tradeoffs that are not reachable with prior work?
 \item What switching strategy works best in which scenario? For which workload?
 \item What is the performance overhead of each cipher switching strategy?
 \item What is the storage overhead of each cipher switching strategy?
 \item How does incorporation of cipher-switching change the threat analysis?
\end{enumerate}

\subsection{Reaching Between Static Configuration Points}

\TODO{Add discussion of the different sizes and how they relate. Add exhaustive
set of charts and then something that says these trends are similar across
workloads, so from now on we just focus on 5MB}

\subsection{Switching Strategies Under Various Workloads}

\TODO{There should be a description of exactly how the experiments were setup to
answer this question, a description of the chart (what are the axes, what are
the points/lines/bars), a textual description of the results in the chart, and
then the conclusion we can draw regarding the question for that subsection.}

\subsection{Cipher Switching Overhead}

\TODO{There should be a description of exactly how the experiments were setup to
answer this question, a description of the chart (what are the axes, what are
the points/lines/bars), a textual description of the results in the chart, and
then the conclusion we can draw regarding the question for that subsection.}

\subsection{Augmented Threat Analysis}

\TODO{Reuse the table from the strongbox paper, but have a different column for
forward, selective, and mirrored.}

\begin{figure*}[ht]
   \textbf{Forward Switching I/O Ratio Performance}\par\medskip
   \centering
   {\input{charts/tradeoff-with-ratios.tex}} \caption{Median sequential and
   random read and write latency per I/O operation size (4KB, 512KB, 5MB, 40MB)
   using multiple cipher configurations ordered by security score. With Forward
   switching, we achieve additional configurations unachievable with prior work
   incapable of switching.}
  \label{fig:tradeoff-with-ratios}
\end{figure*}

\TODO{Move all the following analysis into their proper subsections above.}

\figref{tradeoff-with-ratios} shows the 40MB read performance of three ciphers:
ChaCha8, ChaCha20, and Freestyle in its ``fast'' configuration. This illustrates
the tradeoff space between latency/energy and security for these three static
discrete pareto optimal configurations achievable offline via prior work.

\figref{tradeoff-with-ratios} additionally illustrates the flexibility of
SwitchBox using the 0-forward switching strategy to reach pareto optimal dynamic
configuration points \emph{between} traditional static configuration in the
tradeoff space that are unachievable via prior work.

\begin{figure*}[ht]
   \textbf{Mirrored and Selective Switching I/O Ratio Performance}\par\medskip
   \centering
   {\input{charts/mirrored-selective-baseline.tex}} \caption{Median sequential
   and random read and write latency per I/O operation size (4KB, 512KB, 5MB,
   40MB) using multiple cipher configurations ordered by security score;
   performance comparison of Mirrored and Selective switching strategies to
   baseline.}
  \label{fig:mirrored-selective-baseline}
\end{figure*}

\figref{mirrored-selective-baseline} show the the performance of forward,
mirrored, and selective strategies against two 40MB read and write workloads:
Freerun and WORM. \TODO{Explain these two workloads.} Additionally, the time
required to transition the entire backing store from one cipher to the other is
included \TODO{This is ``time to cipher switch'' or TTCS, but this is renamed in
the actual figure.}

1-forward and 2-forward have overhead that makes them slower than forward 0 for
sequential and random freerun. However, WORM workload shows 1-forward
outperforming 0-forward by \TODO{include percentage (it's small)}. This is
because WORM workload characteristics allow benefits of more aggressive forward
switching to be realized \TODO{Elaborate more here}.

The mirrored and selective switching strategies achieve read parity with the
static cipher configurations, hence their performance. However, mirrored stacks
write latency of both ciphers in the pair because writes are mirrored across
both partitions. On the other hand, selective switching achieves write parity
with the static configuration. Mirrored and selective are not preferable to
forward in all circumstances because drive space is traded off; in our
experiments, half the drive is lost to partitioning.

\TODO{Word these paragraphs better. Include numbers from chart to be more
specific.}

Selective is usually preferable to mirrored due to Mirrored strategy's egregious
write overhead. However, forward and selective take a comparatively long time to
transition the entire backing store from one cipher to the other while mirrored
can achieve this virtually instantaneously. If it is not desirable to maintain
both encrypted versions of data on the backing store, one partition or the other
can be TRIM-ed and the data deleted relatively quickly. On the other hand, when
using the Selective strategy, it is not possible to transition the backing store
entirely to one cipher or another (hence no bar for TTCS). For the forward
strategy, it takes a long time. \TODO{Specific numbers from chart need to go in
here.}
