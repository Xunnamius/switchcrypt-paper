\section{Evaluation}\label{sec:eval}

In this section we answer the following questions:

\begin{enumerate}
  \item {\bf Why switch?} What shape is the security-latency tradeoff space of
  crypts given our workloads? (\cref{subsec:eval-baseline})
  \item {\bf Does heterogeneous FDE work?} Can \sys achieve dynamic
  security/energy tradeoffs by reaching configuration points not accessible with
  prior work? (\cref{subsec:eval-dynamic})
  \item {\bf At what cost?} What is the performance and storage overhead of
  switching? (\cref{subsec:eval-overhead})
\end{enumerate}

\mysub{Experimental Setup.} We implement \sys on a Hardkernel Odroid XU3 ARM
big.LITTLE system with Samsung Exynos 5422 A15/A7 heterogeneous multi-processing
quad core CPUs at maximum clock speed, 2 gigabyte LPDDR3 RAM at 933 MHz, and an
eMMC5.0 HS400 backing store running Ubuntu Trusty 14.04.6 LTS, kernel version
3.10.106. Energy monitoring was provided by the Odroid's integrated INA-231
power sensors polled every $\approx{260}$ milliseconds (not including
noise/overhead).

We evaluate \sys using a Linux RAM disk (tmpfs). The maximum theoretical memory
bandwidth for this Odroid model is 14.9GB/s\@. Our observed maximum memory
bandwidth is 4.5GB/s. Using a RAM disk focuses the evaluation on the performance
differences due to different crypts.

\mysub{Methodology.} In each experiment below, we evaluate \sys on two high
level workloads: sequential and random I/O. In both workloads, a number of bytes
are written and then read (either 4KB, 512KB, 5MB, 40MB) 10 times. Each workload
is repeated three times for a total of 240 tests per crypt (720 runs per {\em
ratio}, see below), 30 results per byte size, 120 results per workload. Results
are accumulated and the median is taken. All experiments are performed with
basic Linux I/O commands, bypassing system caching.

When evaluating switching performance, a finer breakdown in workloads is made
using a pre-selected pair of crypts we call the {\em primary} and {\em
secondary}. \sys is initialized using the primary crypt. Once we trigger a
switch, we switch to the secondary crypt. The switch is triggered according to a
certain {\em ratio} of I/O operations. For example: given 10 40MB ``write-read''
(write and then read back) operations, we may write-read 40MB 3 times using the
primary crypt, initiate a switch, and then write-read 40MB 7 times. This would
be a 3:7 ratio. There are three ratios we use to evaluate switching performance:
7:3, 5:5, and 3:7.


% =======================================================
\subsection{Baseline Crypt Performance}\label{subsec:eval-baseline}

\input{graphics/fig-eval-baseline}

\Cref{fig:eval-baseline} shows the tradeoff between trade score (x-axis; see
also \cref{subsec:des-discussion}) and median normalized latency (y-axis) of
different crypts for our sequential and random I/O workloads. Trends for median
hold when looking at tail latencies as well. Each line represents one workload:
4KB, 512KB, 5MB, and 40MB respectively (see legend). Each symbol represents one
of our crypts: ChaCha8 (C8), ChaCha20 (C20), Freestyle Fast (FF), Freestyle
Balanced (FB), and Freestyle Strong (FS). Of these crypts, those with higher
trade scores resulted in higher overall latency and increased energy use for I/O
operations. The relationship between these concerns is not linear across crypts,
however, which exposes a rich tradeoff space.

Besides the 4KB workload, the shape of each workload follows a similar trend,
hence we will focus on 40MB and 4KB workloads here. Due to the overhead of
metadata management and the fast completion time of the 4KB workloads (\ie
little time for amortization of overhead), C8 and C20 take longer to complete
than FF. This advantage is not enough to make FB or Secure workloads complete
faster than the ChaCha variants, however.

Though C8 is faster than C20, there is some variability in our timing setup when
capturing extremely fast events occurring close together in time. This is why C8
sometimes appears with higher latency than C20 for normalized 4KB workloads. C8
is not slower than C20.


% =======================================================
\subsection{Heterogeneous FDE Performance}\label{subsec:eval-dynamic}

\input{graphics/fig-eval-forward}

\Cref{fig:eval-forward} shows the tradeoff between trade score (x-axis; see also
\cref{subsec:des-discussion}) and median normalized latency (y-axis) of
different crypts for our sequential and random I/O workloads using Forward
switching. After a certain number of write-read operations using the primary
crypt, a switch is initiated and \sys begins using the secondary crypt for I/O.
For each pair of crypts in the figure (primary+secondary: C8+C20, C20+FF, FF+FB,
FB+FS), this is repeated three times: once at every ratio point {\em between}
our crypts (\ie{7:3, 5:5, and 3:7 described above}).

\input{graphics/fig-eval-ms}

The point of this experiment is to determine if \sys can switch the encryption
efficiently enough to support heterogeneous FDE---that is, contiguous nuggets
encrypted with different crypts---without devastating performance. For the 40MB,
5MB, and 512KB workloads (40MB is shown), we see that \sys can achieve dynamic
security/energy tradeoffs reaching points not accessible with prior work, all
with minimal overhead.

Again, due to the overhead of metadata management and fast completion time of
the workloads, C8 and C20 take longer to complete than FF for 4KB reads. We also
see very high latency for ratios between FF and FS crypts. This is because
Freestyle is non-length-preserving, so extra operations must be performed on
every write, and the algorithm itself is generally much slower than the ChaCha
variants.

\Cref{fig:eval-ms} shows the performance of the Mirrored and Selective models
with the same configuration of ratios as \cref{fig:eval-forward}.

For the 40MB, 5MB, and 512KB workloads (40MB is shown), we see that Mirrored and
Selective {\em read} workloads and the Selective {\em write} workload are very
similar to the Forward model experiments. This makes sense, as most of the
overhead for Selective and Mirrored reads is determining which part of the drive
to commit data to. The same applies to Selective writes. For the 4KB Mirrored
and Selective {\em read} workloads and the Selective {\em write} workload, we
see behavior similar to that in \cref{fig:eval-forward}, as expected.

Mirrored writes across all workloads are slow. This is to be expected since
writes are being duplicated. This overhead is most egregious for the 4KB
Mirrored write workload.


% =======================================================
\subsection{Switching Overhead}\label{subsec:eval-overhead}

We calculate that Forward switching has average latency overhead at 0.08x/0.10x
(read/write) for 40MB, 5MB and 512KB workloads compared to baseline I/O,
demonstrating \sys's amortization of switching costs. Average overhead is
0.38x/0.44x (read/write) for 4KB workloads, where \sys is unable to amortize
cost. Similarly, we calculate that Selective switching has average overhead at
0x/0.3x (read/write) for 40MB, 5MB and 512KB workloads compared to baseline I/O.
Average overhead is 0.22x/0.71x (read/write) for 4KB workloads. Finally, we
calculate that Mirrored switching has average overhead at 0.25x/0.61x
(read/write) for 40MB, 5MB and 512KB workloads compared to baseline I/O, with
high write latency due to mirroring. Average overhead is 0.55x/0.77x
(read/write) for 4KB workloads.

Overhead is the penalty paid to implement heterogeneous FDE. \sys's design keeps
these overheads acceptably low in practice.
