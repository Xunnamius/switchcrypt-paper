\section{Introduction}\label{sec:introduction}

There are several important concerns modern filesystems must balance. Paramount
among them are data security and performance. Increasingly important is energy
consumption in both mobile devices and in enterprise storage
\cite{android-M-mobile-motivation, enterprise-motivation}. However, all of these
concerns exist in contention with one another: stronger security properties can
harm latency and require increased energy use, while reducing energy consumption
will generally require increasing latency or accepting weaker security
properties.

The state of the art for securing data is Full-Drive Encryption (FDE).
Traditional FDE employs a single \emph{cryptographic cipher} to encrypt,
decrypt, and authenticate backing store contents on the fly. Understandably,
this process impacts system performance and energy use considerably. Yet, end
users expect their device to be secure \emph{and} performant \emph{and} energy
efficient. The obvious solution is to balance these concerns with respect to the
most general use case and ship the product, but this common-case approach often
fails to deliver an optimal outcome for specific users and workloads.

An example is Google's Android OS. Android supported FDE with the release of
Android 3.0, yet it was not enabled by default until Android
6.0~\cite{android-M-mobile-motivation}. Two years prior, Google attempted to
roll out FDE by default on Android 5.0 but had to backtrack. In a statement to
Engadget, Google blamed ``'performance issues on some partner devices' ... for
the backtracking''~\cite{google-engadget}. AnandTech reported a ``62.9\% drop in
random read performance, a 50.5\% drop in random write performance, and a
staggering 80.7\% drop in sequential read
performance''~\cite{android-M-mobile-motivation-2}.

Traditionally, FDE's impact on drive performance and energy efficiency depends
on choice of filesystem/mapper and the choice of cipher, as different ciphers
expose different performance and efficiency characteristics while offering
contrasting security properties. In this way, cipher choice can be viewed as a
key \emph{configuration} parameter for FDE systems. The tradeoffs of choosing a
cipher include: 1) increased system performance (\ie{overall reduced FDE
overhead}), 2) reduced energy use, and 3) the ability to encrypt devices that
would otherwise be too slow or energy-inefficient to support FDE.

However, the de facto standard choice for FDE is the slow AES \emph{block
cipher} (AES-XTS)~\cite{AES, AES-XTS}. Prior research introduced the motivation
and method for using \emph{stream ciphers} like the high performance ChaCha20
cipher for FDE in lieu of AES-XTS~\cite{StrongBox, ChaCha20}. More recent
work---such as Google's HBSH (hash, block cipher, stream cipher, hash) and
Adiantum~\cite{HBSH, Adiantum}---brings the use of stream ciphers for drive
encryption to industrial strength products.

There is a rich choice of stream ciphers with a variety of different performance
characteristics and opposing security properties. Some of these include: ChaCha
variants with different round counts (e.g., ChaCha8 and ChaCha20) or stronger
security properties (e.g., Freestyle) and others---SalsaX, AES in counter mode
(AES-CTR), Rabbit, Sosemanuk, etc~\cite{Freestyle, SalsaX, Rabbit, Sosemanuk,
ChaCha20, AES-CTR}. Given this variety, the cipher configuration providing the
fastest I/O throughput is almost always different than the configuration
providing the most desirable security properties, and both may differ from the
configuration that uses the least energy or allows the most writable
drive space.

Further, while the cipher choice can be configured statically at compile- or
boot-time with respect to some common-case, in traditional FDE, these
configurations cannot adapt to changes that might arise while the system is
running. Examples include changes in resource availability, runtime environment,
desired security properties, and adhering to changing OS energy budgets.

Hence, any common-case configuration will inevitably sacrifice one concern for
another, even when it is not optimal to the end user. \emph{But what if our
system did not have to sit at some generic configuration point, especially when
another configuration becomes more desirable later on?}\\
\\
\textbf{Our Contributions}\\
To realize the goal of flexibly adjusting storage tradeoffs, we first introduce
a novel design substantively expanding prior FDE work by \emph{decoupling}
cipher implementations from the encryption process. We then introduce the idea
of cipher switching using \emph{switching strategies} to ``re-cipher'' storage
units dynamically with acceptable overhead. Finally, we take advantage of cipher
switching with a scheme to \emph{quantify} the relative strength of ciphers
based on key security properties relevant to FDE. We call these ``security
scores.'' Using these security scores, we define a tradeoff space of cipher
configurations over competing concerns: total energy use, desirable security
properties in the FDE context, read and write performance, total writable space
on the drive, and how quickly the drive can converge to a single configuration.

Unifying these contributions, we present SwitchCrypt, a software mechanism that
navigates the tradeoff space made by balancing competing security and latency
requirements via cipher switching in space or time. We implement SwitchCrypt and
three switching strategies---\emph{Forward}, \emph{Selective}, and
\emph{Mirrored}---to dynamically change between the ChaCha and Freestyle stream
ciphers using our novel API. We then study SwitchCrypt's flexibility through
four case studies where latency, energy, and desired security properties change
dynamically. SwitchCrypt achieves a reduction of at least 3.3x in total energy
use when compared to static approaches; further, we see a reduction of 3.1x to
4.8x for read latency and 1.6x to 2.8x for write latency compared to static
approaches that must pick a single point in the latency/energy/security tradeoff
space.
