\section{Introduction} \label{sec:introduction}

The state of the art for securing data at rest, such as the contents of a
laptop's SSD, is Full Drive Encryption (FDE). Traditional FDE employs a single
cryptographic cipher to encrypt, decrypt, and authenticate drive contents on the
fly. Unfortunately, encryption introduces overhead that drastically impacts
system performance and total energy consumption. Hence, modern storage systems
must carefully balance these competing concerns. On the one hand, stronger
security guarantees come with increased latency and threaten to balloon energy
consumption. On the other, capping total energy consumption requires tolerating
increased latency or weaker security guarantees.

FDE implementations such as dm-crypt~\cite{dmcrypt,DmC-Android} for Linux and
BitLocker for Windows~\cite{bitlocker} balance these concerns with respect to
some generic ``common case'' workload, but this approach often fails to deliver
an optimal outcome for specific workloads. Google's Android OS is a good
example. Android supported FDE with the release of Android 3.0, yet it was not
enabled by default until Android 6.0~\cite{android-M-mobile-motivation}. Two
years prior, Google attempted to roll out FDE by default on Android 5.0 but had
to backtrack. In a statement to Engadget, Google blamed ``'performance issues on
some partner devices' ... for the backtracking''~\cite{google-engadget}. At the
same time, AnandTech reported a ``62.9\% drop in random read performance, a
50.5\% drop in random write performance, and a staggering 80.7\% drop in
sequential read performance'' versus Android 5.0 unencrypted storage for various
workloads~\cite{android-M-mobile-motivation-2}.

FDE's impact on drive performance and energy efficiency depends on a multitude
of choices. Paramount among them is the choice of cipher, as different ciphers
expose different performance and energy efficiency characteristics. In this way,
cipher choice can be viewed as a key \emph{configuration parameter} for FDE
systems. The benefits of choosing one cipher over another might include: 1)
improved performance (\ie{overall reduction in FDE overhead}), 2) reduced energy
use, 3) more useful security guarantees, and 4) the ability to encrypt devices
that would otherwise be too slow or energy-inefficient to support FDE.

However, the standard cipher choice for FDE is the slow AES \emph{block cipher}
(AES-XTS)~\cite{XTS, XTSComments, NISTXTS}. Dickens et al. introduced a method
for using ciphers other than AES-XTS for FDE; specifically, the high performance
ChaCha20 \emph{stream cipher}~\cite{StrongBox, ChaCha20}. More recent
work---such as Google's HBSH (hash, block cipher, stream cipher, hash) and
Adiantum~\cite{Adiantum}---brings stream cipher based FDE to devices that do not
or cannot support hardware accelerated AES. Hence, it has been demonstrated that
using stream ciphers for FDE is both desirable in a variety of contexts and
feasible at industry scale.

In this paper, we explore the rich configuration space of stream
ciphers beyond the narrow scope of previous work. Each cipher comes
with a variety of performance, energy efficiency, and security
properties in the FDE context.  These ciphers include ChaCha variants
with different round counts (e.g., ChaCha8 and
ChaCha12)~\cite{ChaCha20}, ciphers with stronger security guarantees
versus more robust adversaries (e.g., Freestyle~\cite{Freestyle}), and
other ciphers like SalsaX~\cite{SalsaX}, AES in counter mode
(AES-CTR)~\cite{AESCTR}, Rabbit~\cite{Rabbit},
Sosemanuk~\cite{Sosemanuk}, etc.  Given this variety, the cipher
configuration providing the least latency overhead is almost always
different than the configuration providing the most desirable security
properties, and both may differ from the configuration using the least
energy or preserving the most free space on the encrypted drive.
\hank{This is a strong claim, maybe add a parenthetical forward
  reference to the section that has the data to back this up.}

Further, while cipher choice might be configured statically at compile or boot
time with respect to some common case in traditional FDE, such configurations
cannot dynamically adapt to changes that arise while the system is running.
Examples include changes in resource availability, runtime environment, desired
security properties, and respecting changing OS energy budgets. Hence, any
static common-case FDE configuration will sacrifice one concern for another,
even when it is not optimal to do so for a given workload.

Hence we present SwitchCrypt, a storage layer that can quickly and dynamically
transition to a more desirable configuration given runtime changes. In one case
study, where we require the filesystem to react to a shrinking energy budget by
switching ciphers (\cref{subsec:uc1}), we find that SwitchCrypt achieves up to a
3.3x total energy use reduction compared to prior static approaches that only
use the Freestyle stream cipher without switching. In another case, where we
allow the user to manually switch between ChaCha20 and Freestyle stream ciphers
dynamically (\cref{subsec:uc2}), we achieve a 3.1x to 4.8x reduction to read
latency and 1.6x to 2.8x reduction to write latency compared to prior static
approaches.

\PUNT{We make the SwitchCrypt source publicly available open
  source\footnote{\label{note1}\SystemURI}.} \hank{You should still
  note that it is publicly available. If you punted this because you
  can put the link in HotCRP, just have the footnote state that it is
  available through HotCRP.}

\hank{I have a couple of other high-level notes at this point.
  \\
  First, the references seem pretty sparse for a conference these
  days.  I would guess that the typical paper I review has about 50
  references.  Consider adding some more citations to PC members who
  work on security or fileseystems.
  \\
  Second, I find the transition from section 1 to section 2 way to
  abrupt.  We cannot count on paper readers having actually seen the
  extended abstract.  I think referring to it for the motivational
  example is fine, becuase if they don't go back and read it, they can
  still follow.  It might, however, be worth restating the challenges
  that Section 2 addresses in the beginnig of that section.  Or at
  least giving an overview of what Section 2 covers.
  \\
  Third, our use of both an evaluation and case studies is a little
  different than what people should expect.  The last paragraph of the
  intro alerts people that case studies are coming, which is good, but
  it doesn't talk about the evalution.  It needs a sentence or two to
  explain what the evaluation accomplishes in the context of the
  overall paper.  Why should readers pay attention to that part?  What
  will they learn?
  \\
  Finally, the related work is a bit unsatisfying.  That is partly
  structure and partly length.
  \\
  And one meta-level thought: I'm asking you to add stuff here and I
  know we are at the page limit.  But, my sense is that we will be
  able to compact this down quite a lot without a whole lot of
  trouble.  So, right now let's focus on adding all the content that
  we need and we can worry about length later in the week.  }
